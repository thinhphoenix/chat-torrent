"use strict";(self.webpackChunkreact=self.webpackChunkreact||[]).push([["75"],{2838(e,t,s){s.r(t),s.d(t,{component:()=>ec});var a=s(9974),r=s(3277),n=s(8390),l=s(38),o=s(8398),i=s(6714),d=s(2184),c=s(5007),m=s(3251),u=s(5772),x=s(8972),p=s(9924),h=s(5800);function f(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,h.QP)((0,p.$)(t))}let g=(0,x.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function v(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:f(g({variant:s}),t),...r})}var b=s(2386);let j=(0,x.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 cursor-pointer",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),y=n.forwardRef((e,t)=>{let{className:s,variant:r,size:n,asChild:l=!1,...o}=e,i=l?b.DX:"button";return(0,a.jsx)(i,{className:f(j({variant:r,size:n,className:s})),ref:t,...o})});y.displayName="Button";var w=s(1407);let N=w.bL,k=w.l9;w.YJ;let C=n.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...n}=e;return(0,a.jsx)(w.ZL,{children:(0,a.jsx)(w.UC,{ref:t,sideOffset:r,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})})});C.displayName=w.UC.displayName;let S=n.forwardRef((e,t)=>{let{className:s,inset:r,...n}=e;return(0,a.jsx)(w.q7,{ref:t,className:f("relative flex cursor-pointer select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",r&&"pl-8",s),...n})});S.displayName=w.q7.displayName;let R=n.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(w.wv,{ref:t,className:f("-mx-1 my-1 h-px bg-muted",s),...r})});function M(e){let{roomId:t,isHost:s,peerCount:r,matchmaking:n,onShareClick:x,onRandomConnect:p,onCancelMatchmaking:h,onLeaveRoom:f,onTogglePeers:g}=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:[(0,a.jsx)("div",{className:"flex items-center gap-3 min-w-0",children:(0,a.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("h1",{className:"text-sm font-semibold truncate",children:["Room: ",t]}),s&&(0,a.jsxs)(v,{variant:"default",className:"text-[10px] px-1.5 py-0 h-4 shrink-0",children:[(0,a.jsx)(l.O,{className:"h-2.5 w-2.5 mr-0.5",weight:"fill"}),"Host"]})]}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[r+1," member",0!==r?"s":""]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[n&&(0,a.jsxs)(y,{variant:"outline",size:"sm",onClick:h,className:"text-xs gap-1.5",children:[(0,a.jsx)(o.y,{className:"h-3.5 w-3.5 animate-spin"}),"Searching..."]}),(0,a.jsx)(y,{variant:"ghost",size:"icon",onClick:g,title:"Toggle peer list",children:(0,a.jsx)(i.n,{className:"h-5 w-5"})}),(0,a.jsxs)(N,{children:[(0,a.jsx)(k,{asChild:!0,children:(0,a.jsx)(y,{variant:"ghost",size:"icon",children:(0,a.jsx)(d.L,{className:"h-5 w-5",weight:"bold"})})}),(0,a.jsxs)(C,{align:"end",className:"w-48",children:[(0,a.jsxs)(S,{onClick:x,children:[(0,a.jsx)(c.s,{className:"h-4 w-4"}),"Share Room"]}),(0,a.jsxs)(S,{onClick:p,disabled:n,children:[(0,a.jsx)(m.g,{className:"h-4 w-4"}),"Talk to Random"]}),(0,a.jsx)(R,{}),(0,a.jsxs)(S,{onClick:f,className:"text-destructive focus:text-destructive",children:[(0,a.jsx)(u.F,{className:"h-4 w-4"}),s?"Close Room":"Leave Room"]})]})]})]})]})}R.displayName=w.wv.displayName,n.forwardRef((e,t)=>{let{className:s,inset:r,...n}=e;return(0,a.jsx)(w.JU,{ref:t,className:f("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...n})}).displayName=w.JU.displayName;var I=s(1209);let z=n.forwardRef((e,t)=>{let{className:s,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:f("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...n})});function L(e){let{onSend:t}=e,[s,r]=(0,n.useState)(""),l=()=>{let e=s.trim();e&&(t(e),r(""))};return(0,a.jsx)("div",{className:"border-t bg-background p-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(z,{value:s,onChange:e=>r(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),l())},placeholder:"Type a message...",className:"flex-1 rounded-full bg-muted border-0 focus-visible:ring-1"}),(0,a.jsx)(y,{type:"button",size:"icon",onClick:l,disabled:!s.trim(),className:"shrink-0 rounded-full",title:"Send message",children:(0,a.jsx)(I.M,{className:"h-5 w-5",weight:"fill"})})]})})}z.displayName="Input";var P=s(8901),T=s(2589);let D=n.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(T.bL,{ref:t,className:f("relative flex h-8 w-8 shrink-0 overflow-hidden rounded-full",s),...r})});D.displayName=T.bL.displayName;let E=n.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(T.H4,{ref:t,className:f("flex h-full w-full items-center justify-center rounded-full bg-muted text-xs font-medium",s),...r})});E.displayName=T.H4.displayName;var H=s(5306);let O=n.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(H.bL,{ref:t,className:f("relative overflow-hidden",s),...n,children:[(0,a.jsx)(H.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(U,{}),(0,a.jsx)(H.OK,{})]})});O.displayName=H.bL.displayName;let U=n.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...n}=e;return(0,a.jsx)(H.VM,{ref:t,orientation:r,className:f("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...n,children:(0,a.jsx)(H.lr,{className:"relative flex-1 rounded-full bg-border"})})});function F(e){let{messages:t,hostId:s}=e,r=(0,n.useRef)(null);return((0,n.useEffect)(()=>{var e;null==(e=r.current)||e.scrollIntoView({behavior:"smooth"})}),0===t.length)?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted-foreground text-sm",children:"No messages yet. Start chatting!"}):(0,a.jsx)(O,{className:"flex-1 px-4",children:(0,a.jsxs)("div",{className:"space-y-3 py-4",children:[t.map(e=>{if("system"===e.type)return(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("span",{className:"text-xs text-muted-foreground bg-muted px-3 py-1 rounded-full",children:e.content})},e.id);let t=e.senderId===P.Mu,r=e.senderId===s;return(0,a.jsxs)("div",{className:f("flex gap-2 max-w-[85%]",t?"ml-auto flex-row-reverse":""),children:[!t&&(0,a.jsx)(D,{className:"h-8 w-8 shrink-0 mt-1",children:(0,a.jsx)(E,{className:"text-[10px] bg-primary/10 text-primary",children:e.senderName.slice(0,2).toUpperCase()})}),(0,a.jsxs)("div",{className:f("flex flex-col",t?"items-end":"items-start"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 mb-0.5",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:t?"You":e.senderName}),r&&(0,a.jsx)(v,{variant:"secondary",className:"text-[10px] px-1 py-0 h-4",children:"Host"}),(0,a.jsx)("span",{className:"text-[10px] text-muted-foreground/60",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsx)("div",{className:f("rounded-2xl px-3 py-2 text-sm break-words",t?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted rounded-tl-sm"),children:(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:e.content})})]})]},e.id)}),(0,a.jsx)("div",{ref:r})]})})}U.displayName=H.VM.displayName;var J=s(4863),$=s(8393),K=s(5133);let Y=n.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:n=!0,...l}=e;return(0,a.jsx)(K.b,{ref:t,decorative:n,orientation:r,className:f("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...l})});function _(e){let{peers:t,hostId:s,isHost:r,myName:n,onKick:o}=e,i=[{id:P.Mu,name:n,isSelf:!0},...t.map(e=>({...e,isSelf:!1}))];return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 px-4 py-3 border-b",children:[(0,a.jsx)(J.z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:["Members (",i.length,")"]})]}),(0,a.jsx)(O,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2 space-y-1",children:i.map(e=>{let t=e.id===s;return(0,a.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded-md hover:bg-muted/50 group",children:[(0,a.jsx)(D,{className:"h-7 w-7",children:(0,a.jsx)(E,{className:"text-[10px] bg-primary/10 text-primary",children:e.name.slice(0,2).toUpperCase()})}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsxs)("span",{className:"text-sm truncate",children:[e.name,e.isSelf&&(0,a.jsx)("span",{className:"text-muted-foreground",children:" (you)"})]}),t&&(0,a.jsx)(l.O,{className:"h-3.5 w-3.5 text-amber-500 shrink-0",weight:"fill"})]})}),r&&!e.isSelf&&(0,a.jsx)(y,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity text-destructive hover:text-destructive",onClick:()=>o(e.id),title:`Kick ${e.name}`,children:(0,a.jsx)($.K,{className:"h-3.5 w-3.5"})})]},e.id)})})}),(0,a.jsx)(Y,{}),(0,a.jsx)("div",{className:"p-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[r&&(0,a.jsxs)(v,{variant:"default",className:"text-[10px]",children:[(0,a.jsx)(l.O,{className:"h-3 w-3 mr-0.5",weight:"fill"}),"Host"]}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground truncate",children:n})]})})]})}Y.displayName=K.b.displayName;var A=s(8279),V=s(4015);function q(){let e="abcdefghijklmnopqrstuvwxyz0123456789",t="";for(let s=0;s<8;s++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}var B=s(2634),Q=s(3854);let W=Q.bL;Q.l9;let Z=Q.ZL;Q.bm;let X=n.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(Q.hJ,{ref:t,className:f("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});X.displayName=Q.hJ.displayName;let G=n.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(Z,{children:[(0,a.jsx)(X,{}),(0,a.jsxs)(Q.UC,{ref:t,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:[r,(0,a.jsxs)(Q.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground cursor-pointer",children:[(0,a.jsx)(B.X,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});G.displayName=Q.UC.displayName;let ee=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:f("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};ee.displayName="DialogHeader";let et=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:f("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})};et.displayName="DialogFooter";let es=n.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(Q.hE,{ref:t,className:f("text-lg font-semibold leading-none tracking-tight",s),...r})});es.displayName=Q.hE.displayName;let ea=n.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(Q.VY,{ref:t,className:f("text-sm text-muted-foreground",s),...r})});function er(e){let t,{open:s,onOpenChange:l,roomId:o,password:i,isHost:d,onSetPassword:m}=e,[u,x]=(0,n.useState)(!1),[p,h]=(0,n.useState)(!1),[f,g]=(0,n.useState)(""),v=((t=new URL(window.location.origin+window.location.pathname)).searchParams.set("room",o),t.toString()),b=async(e,t)=>{try{await navigator.clipboard.writeText(e)}catch{let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}"link"===t?(x(!0),setTimeout(()=>x(!1),2e3)):(h(!0),setTimeout(()=>h(!1),2e3))},j=()=>{let e=f.trim();e&&m&&(m(e),g(""))};return(0,a.jsx)(W,{open:s,onOpenChange:l,children:(0,a.jsxs)(G,{className:"sm:max-w-md",children:[(0,a.jsxs)(ee,{children:[(0,a.jsxs)(es,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.s,{className:"h-5 w-5"}),"Share Chat Room"]}),(0,a.jsx)(ea,{children:"Share the link to invite others. Send the password separately for security."})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"share-link",className:"text-sm font-medium mb-1.5 block",children:"Invite Link"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(z,{id:"share-link",value:v,readOnly:!0,className:"bg-muted text-xs"}),(0,a.jsx)(y,{type:"button",size:"icon",variant:"outline",onClick:()=>b(v,"link"),className:"shrink-0",title:"Copy link",children:u?(0,a.jsx)(A.J,{className:"h-4 w-4 text-green-500"}):(0,a.jsx)(V.Q,{className:"h-4 w-4"})})]})]}),i&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"share-pw",className:"text-sm font-medium mb-1.5 flex items-center gap-1.5",children:[(0,a.jsx)(r.c,{className:"h-3.5 w-3.5"}),"Password"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(z,{id:"share-pw",value:i,readOnly:!0,className:"bg-muted text-xs font-mono"}),(0,a.jsx)(y,{type:"button",size:"icon",variant:"outline",onClick:()=>b(i,"pw"),className:"shrink-0",title:"Copy password",children:p?(0,a.jsx)(A.J,{className:"h-4 w-4 text-green-500"}):(0,a.jsx)(V.Q,{className:"h-4 w-4"})})]}),(0,a.jsx)("p",{className:"text-[11px] text-muted-foreground mt-1",children:"Share this password separately â€” never in the link."})]}),d&&m&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"set-pw",className:"text-sm font-medium mb-1.5 flex items-center gap-1.5",children:[(0,a.jsx)(r.c,{className:"h-3.5 w-3.5"}),i?"Change Password":"Set Password"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(z,{id:"set-pw",value:f,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"===e.key&&j()},placeholder:"Enter new password...",type:"text",className:"text-xs"}),(0,a.jsx)(y,{type:"button",size:"sm",variant:"default",onClick:j,disabled:!f.trim(),children:i?"Update":"Set"})]}),(0,a.jsx)("p",{className:"text-[11px] text-muted-foreground mt-1",children:i?"Changing the password will reconnect all peers.":"Set a password to encrypt the room."})]})]}),(0,a.jsx)(et,{children:(0,a.jsx)(y,{type:"button",variant:"secondary",onClick:()=>l(!1),children:"Close"})})]})})}ea.displayName=Q.VY.displayName;let en=["Otter","Fox","Panda","Wolf","Hawk","Lynx","Bear","Deer","Eagle","Shark","Tiger","Lion","Cobra","Raven","Crane","Whale","Bison","Moose","Gecko","Koala","Sloth","Viper","Falcon","Badger","Heron","Zebra","Camel","Lemur","Squid","Robin","Finch","Hippo","Rhino","Macaw","Dingo","Quail","Coyote","Ferret","Marten","Puffin","Toucan","Osprey","Jackal","Iguana","Parrot","Walrus","Alpaca","Condor","Mantis","Salmon"],el="chat_animal_name",eo="p2p-chat-trystero-app",ei=["wss://tracker.openwebtorrent.com","wss://tracker.webtorrent.dev","wss://tracker.fastcast.nz","wss://tracker.btorrent.xyz"],ed=function(){let e,{roomId:t}={roomId:new URLSearchParams(window.location.search).get("room")};return t&&((e=new URL(window.location.href)).searchParams.delete("room"),e.hash="",window.history.replaceState({},"",e.toString())),t}();function ec(){let[e,t]=(0,n.useState)(ed),[s,l]=(0,n.useState)(""),[o,i]=(0,n.useState)(null),[d,c]=(0,n.useState)(!1),[m,u]=(0,n.useState)(!1),{roomId:x,password:p,myName:h,isHost:f,hostId:g,peers:v,messages:b,matchmaking:j,sendMessage:w,kickPeer:N,leaveRoom:k,joinRoomById:C,setRoomPassword:S,connectRandom:R,cancelMatchmaking:I}=function(e,t){let s=(0,n.useRef)(function(){let e,t,s=localStorage.getItem(el);if(s)return s;let a=(e=en[Math.floor(Math.random()*en.length)],t=Math.floor(900*Math.random())+100,`${e}-${t}`);return localStorage.setItem(el,a),a}()),a=P.Mu,[r,l]=(0,n.useState)(()=>e||q()),[o,i]=(0,n.useState)(t||void 0),[d,c]=(0,n.useState)(!e),[m,u]=(0,n.useState)(e?"":P.Mu),[x,p]=(0,n.useState)([]),[h,f]=(0,n.useState)([]),[g,v]=(0,n.useState)(!1),[b,j]=(0,n.useState)(!1),y=(0,n.useRef)(null),w=(0,n.useRef)(null),N=(0,n.useRef)({}),k=(0,n.useCallback)(e=>{f(t=>[...t,{id:`sys-${Date.now()}-${Math.random()}`,senderId:"system",senderName:"System",type:"system",content:e,timestamp:Date.now()}])},[]),C=(0,n.useCallback)((e,t,a)=>{y.current&&(y.current.leave(),y.current=null);let r={appId:eo,relayUrls:ei};t&&(r.password=t);let n=(0,P.O3)(r,e);y.current=n;let o=a??!1;l(e),i(t),c(o),u(o?P.Mu:""),p([]),f([]),v(!0),k(o?`You created room "${e}". You are the host.`:`You joined room "${e}".`);let[d,m]=n.makeAction("message"),[x,h]=n.makeAction("profile"),[g,b]=n.makeAction("control");return N.current={sendMessage:d,sendProfile:x,sendControl:g},n.onPeerJoin(e=>{x({name:s.current},e),o&&g({type:"host-announce",hostId:P.Mu},e),p(t=>t.find(t=>t.id===e)?t:[...t,{id:e,name:e.slice(0,8)}]),k("A peer connected.")}),n.onPeerLeave(e=>{p(t=>{let s=t.find(t=>t.id===e);return s&&k(`${s.name} left the room.`),t.filter(t=>t.id!==e)})}),m((e,t)=>{f(s=>[...s,{id:e.id,senderId:t,senderName:e.senderName,type:e.type,content:e.content,timestamp:e.timestamp}])}),h((e,t)=>{p(s=>s.find(e=>e.id===t)?s.map(s=>s.id===t?{...s,name:e.name}:s):[...s,{id:t,name:e.name}])}),b(e=>{if("host-announce"===e.type&&u(e.hostId),"kick"===e.type&&e.targetId===P.Mu){k("You were kicked from the room."),n.leave(),y.current=null;let e=q();setTimeout(()=>{C(e,void 0,!0),k("You are now in your own room as host.")},100)}if("room-close"===e.type){k("The host closed the room."),n.leave(),y.current=null;let e=q();setTimeout(()=>{C(e,void 0,!0),k("You are now in your own room as host.")},100)}}),n},[k]);(0,n.useEffect)(()=>{m&&m!==P.Mu&&!x.some(e=>e.id===m)&&0===x.length&&g&&P.Mu},[x,m,g]);let S=(0,n.useRef)({roomId:r,password:o,isHost:d}),R=(0,n.useRef)(C);R.current=C,(0,n.useEffect)(()=>{let{roomId:e,password:t,isHost:s}=S.current,a=R.current(e,t,s);return()=>{a.leave(),y.current=null}},[]);let M=(0,n.useCallback)(e=>{var t,a;let r={id:`msg-${Date.now()}-${Math.random()}`,type:"text",content:e,senderName:s.current,timestamp:Date.now()};f(e=>[...e,{id:r.id,senderId:P.Mu,senderName:s.current,type:r.type,content:r.content,timestamp:r.timestamp}]),null==(t=(a=N.current).sendMessage)||t.call(a,r)},[]),I=(0,n.useCallback)(e=>{d&&N.current.sendControl&&(N.current.sendControl({type:"kick",targetId:e},e),N.current.sendControl({type:"kick",targetId:e}),p(t=>{let s=t.find(t=>t.id===e);return s&&k(`${s.name} was kicked.`),t.filter(t=>t.id!==e)}))},[d,k]),z=(0,n.useCallback)(()=>{d&&N.current.sendControl&&N.current.sendControl({type:"room-close"}),y.current&&(y.current.leave(),y.current=null),C(q(),void 0,!0)},[d,C]),L=(0,n.useCallback)((e,t)=>{y.current&&(d&&N.current.sendControl&&N.current.sendControl({type:"room-close"}),y.current.leave(),y.current=null),C(e,t,!1)},[d,C]),T=(0,n.useCallback)(()=>{j(!0);let e=(0,P.O3)({appId:eo,relayUrls:ei},"__matchmaking_lobby__");w.current=e;let[t,s]=e.makeAction("matchmaking");e.onPeerJoin(s=>{if(P.Mu<s){let a=q(),r=Math.random().toString(36).slice(2,10);t({type:"match",roomId:a,password:r},s),setTimeout(()=>{e.leave(),w.current=null,j(!1),y.current&&(y.current.leave(),y.current=null),C(a,r,!0)},500)}}),s(t=>{"match"===t.type&&t.roomId&&setTimeout(()=>{e.leave(),w.current=null,j(!1),y.current&&(y.current.leave(),y.current=null),C(t.roomId,t.password,!1)},500)})},[C]),D=(0,n.useCallback)(()=>{w.current&&(w.current.leave(),w.current=null),j(!1)},[]),E=(0,n.useCallback)(e=>{d&&(N.current.sendControl&&N.current.sendControl({type:"room-close"}),C(r,e||void 0,!0))},[d,r,C]);return(0,n.useEffect)(()=>()=>{w.current&&w.current.leave()},[]),{roomId:r,password:o,myName:s.current,myId:a,isHost:d,hostId:m,peers:x,messages:h,connected:g,matchmaking:b,sendMessage:M,kickPeer:I,leaveRoom:z,joinRoomById:L,setRoomPassword:E,connectRandom:T,cancelMatchmaking:D}}((null==o?void 0:o.roomId)??null,(null==o?void 0:o.password)??null),T=()=>{if(!e)return;let a=s.trim()||void 0;i({roomId:e,password:a}),t(null),l(""),C(e,a)},D=()=>{t(null),l("")};return(0,a.jsxs)("div",{className:"flex h-screen bg-background text-foreground",children:[(0,a.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,a.jsx)(M,{roomId:x,isHost:f,peerCount:v.length,matchmaking:j,onShareClick:()=>u(!0),onRandomConnect:R,onCancelMatchmaking:I,onLeaveRoom:k,onTogglePeers:()=>c(e=>!e)}),(0,a.jsx)(F,{messages:b,hostId:g}),(0,a.jsx)(L,{onSend:w})]}),d&&(0,a.jsx)("div",{className:"w-64 border-l bg-background hidden sm:flex flex-col shrink-0",children:(0,a.jsx)(_,{peers:v,hostId:g,isHost:f,myName:h,onKick:N})}),d&&(0,a.jsxs)("div",{className:"sm:hidden fixed inset-0 z-50 flex",children:[(0,a.jsx)("button",{type:"button",className:"flex-1 bg-black/40",onClick:()=>c(!1),"aria-label":"Close peer list"}),(0,a.jsx)("div",{className:"w-72 bg-background border-l flex flex-col",children:(0,a.jsx)(_,{peers:v,hostId:g,isHost:f,myName:h,onKick:N})})]}),(0,a.jsx)(er,{open:m,onOpenChange:u,roomId:x,password:p,isHost:f,onSetPassword:S}),(0,a.jsx)(W,{open:!!e,onOpenChange:()=>D(),children:(0,a.jsxs)(G,{className:"sm:max-w-sm",children:[(0,a.jsxs)(ee,{children:[(0,a.jsxs)(es,{className:"flex items-center gap-2",children:[(0,a.jsx)(r.c,{className:"h-5 w-5"}),"Join Room"]}),(0,a.jsx)(ea,{children:"Enter the room password to join, or skip if the room has no password."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"join-password",className:"text-sm font-medium mb-1.5 block",children:"Password"}),(0,a.jsx)(z,{id:"join-password",value:s,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key&&T()},placeholder:"Enter room password...",type:"password",autoFocus:!0})]}),(0,a.jsxs)(et,{children:[(0,a.jsx)(y,{type:"button",variant:"ghost",onClick:D,children:"Cancel"}),(0,a.jsx)(y,{type:"button",variant:"secondary",onClick:()=>{e&&(i({roomId:e}),t(null),l(""),C(e))},children:"No Password"}),(0,a.jsx)(y,{type:"button",onClick:T,children:"Join"})]})]})})]})}}}]);